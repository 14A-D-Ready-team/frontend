<!-- eslint-disable @angular-eslint/template/eqeqeq -->
<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Kategóriák</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content
  class="ion-padding"
  *ngIf="{loading: loading$ | async, error: error$ | async, editedId : editedId$ | async} as vm"
>
  <ion-refresher
    slot="fixed"
    [disabled]="vm.loading"
    (ionRefresh)="handleRefresh($event)"
  >
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-grid>
    <ion-row>
      <ion-col offset-xl="3" size-xl="6">
        <ion-list>
          <div *ngIf="vm.loading">
            <app-buffets-category-display-skeleton></app-buffets-category-display-skeleton>
            <app-buffets-category-display-skeleton></app-buffets-category-display-skeleton>
            <app-buffets-category-display-skeleton></app-buffets-category-display-skeleton>
            <app-buffets-category-display-skeleton></app-buffets-category-display-skeleton>
          </div>

          <app-ionic-error-card
            *ngIf="vm.error"
            [error]="vm.error"
            header="A kategóriák betöltése sikertelen"
            (retry)="retryLoading()"
          >
          </app-ionic-error-card>
          <form [formGroup]="editorForm" [ngxsForm]="editorFormPath">
            <ng-container *ngIf="!vm.loading && !vm.error">
              <app-buffets-category-display
                *ngFor="let category of categories$ | async; index as i;trackBy: categoryById"
                [isEditing]="vm.editedId === category.id"
                [editDisabled]="vm.editedId != undefined"
                [isLoading]="vm.editedId === category.id && (updateStatus$ | async)?.loading === true"
                [category]="category"
                [editorForm]="vm.editedId === category.id ? editorForm : undefined"
                (editing)="onEditing(category)"
                (editingDone)="onEditingDone($event)"
                (delete)="onDelete(category.id)"
              >
              </app-buffets-category-display>
            </ng-container>

            <app-buffets-category-display
              *ngIf="creatingNew$ | async"
              action="create"
              [isEditing]="true"
              [isLoading]="(createStatus$ | async)?.loading === true"
              [editorForm]="editorForm"
              (editingDone)="onCreatingDone($event)"
            >
            </app-buffets-category-display>
          </form>
        </ion-list>
      </ion-col>
    </ion-row>
  </ion-grid>
  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button [disabled]="vm.editedId != undefined" (click)="create()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
